{
	"Effect": {
		"Name": "GLTF_PBRMetallicRoughness",
		"Parents": ["Common"],
		"DrawStyles": [
			// Fill GBuffer:
			{
				"Conditions": [
					{ "Rule": "RenderPath", "Mode": "Deferred" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Opaque" },
					{ "Rule": "MaterialSidedness", "Mode": "Single" }
				],
				"Technique": "FillGBuffer_SingleSided"
			},
			{
				"Conditions": [
					{ "Rule": "RenderPath", "Mode": "Deferred" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Mask" },
					{ "Rule": "MaterialSidedness", "Mode": "Single" }
				],
				"Technique": "FillGBuffer_SingleSided"
			},
			{
				"Conditions": [
					{ "Rule": "RenderPath", "Mode": "Deferred" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Opaque" },
					{ "Rule": "MaterialSidedness", "Mode": "Double" }
				],
				"Technique": "FillGBuffer_DoubleSided"
			},
			{
				"Conditions": [
					{ "Rule": "RenderPath", "Mode": "Deferred" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Mask" },
					{ "Rule": "MaterialSidedness", "Mode": "Double" }
				],
				"Technique": "FillGBuffer_DoubleSided"
			},

			// Transparency:
			{
				"Conditions": [
					{ "Rule": "RenderPath", "Mode": "Forward" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Blend" },
					{ "Rule": "MaterialSidedness", "Mode": "Single" }
				],
				"Technique": "AlphaBlend_SingleSided"
			},
			{
				"Conditions": [
					{ "Rule": "RenderPath", "Mode": "Forward" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Blend" },
					{ "Rule": "MaterialSidedness", "Mode": "Double" }
				],
				"Technique": "AlphaBlend_DoubleSided"
			},

			// Shadows:
			{
				"Conditions": [
					{ "Rule": "Shadow", "Mode": "2D" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Opaque" },
					{ "Rule": "MaterialSidedness", "Mode": "Single" }
				],
				"Technique": "Shadow_2D_SingleSided_Opaque"
			},
			{
				"Conditions": [
					{ "Rule": "Shadow", "Mode": "2D" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Mask" },
					{ "Rule": "MaterialSidedness", "Mode": "Single" }
				],
				"Technique": "Shadow_2D_SingleSided_AlphaMask"
			},
			{
				"Conditions": [
					{ "Rule": "Shadow", "Mode": "2D" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Opaque" },
					{ "Rule": "MaterialSidedness", "Mode": "Double" }
				],
				"Technique": "Shadow_2D_DoubleSided_Opaque"
			},
			{
				"Conditions": [
					{ "Rule": "Shadow", "Mode": "2D" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Mask" },
					{ "Rule": "MaterialSidedness", "Mode": "Double" }
				],
				"Technique": "Shadow_2D_DoubleSided_AlphaMask"
			},
			{
				"Conditions": [
					{ "Rule": "Shadow", "Mode": "Cube" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Opaque" },
					{ "Rule": "MaterialSidedness", "Mode": "Single" }
				],
				"Technique": "Shadow_Cube_SingleSided_Opaque"
			},
			{
				"Conditions": [
					{ "Rule": "Shadow", "Mode": "Cube" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Mask" },
					{ "Rule": "MaterialSidedness", "Mode": "Single" }
				],
				"Technique": "Shadow_Cube_SingleSided_AlphaMask"
			},
			{
				"Conditions": [
					{ "Rule": "Shadow", "Mode": "Cube" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Opaque" },
					{ "Rule": "MaterialSidedness", "Mode": "Double" }
				],
				"Technique": "Shadow_Cube_DoubleSided_Opaque"
			},
			{
				"Conditions": [
					{ "Rule": "Shadow", "Mode": "Cube" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Mask" },
					{ "Rule": "MaterialSidedness", "Mode": "Double" }
				],
				"Technique": "Shadow_Cube_DoubleSided_AlphaMask"
			}
		],

		"Buffers": ["InstancedTransforms", "GLTF_PBRMetallicRoughness"],

		"Techniques": [
			{
				"Name": "FillGBuffer_SingleSided",
				"VShader": "GLTF_PBRMetallicRoughness_VShader",
				"VShaderDefines":  ["MAX_UV_CHANNEL_IDX 1"],
				"VShaderEntryPoint": "VShader",
				"PShader": "GLTF_PBRMetallicRoughness_GBufferFill_PShader",
				"PShaderDefines":  ["MAX_UV_CHANNEL_IDX 1"],
				"PShaderEntryPoint": "PShader",
				"PipelineState": "SingleSided",
				"VertexStream": "PosNmlTanUvCol"
			},
			{
				"Name": "FillGBuffer_DoubleSided",
				"Parent" :  "FillGBuffer_SingleSided",
				"PipelineState": "DoubleSided"
			},
			{
				"Name": "AlphaBlend_SingleSided",
				"VShader": "GLTF_PBRMetallicRoughness_VShader",
				"VShaderEntryPoint": "VShader",
				"VShaderDefines":  ["MAX_UV_CHANNEL_IDX 1", "VOUT_WORLD_POS"],
				"PShader": "GLTF_PBRMetallicRoughness_Transparency_PShader",
				"PShaderDefines":  ["MAX_UV_CHANNEL_IDX 1", "VOUT_WORLD_POS"],
				"PShaderEntryPoint": "PShader",
				"PipelineState": "SingleSided",
				"VertexStream": "PosNmlTanUvCol"				
			},
			{
				"Name": "AlphaBlend_DoubleSided",
				"VShader": "GLTF_PBRMetallicRoughness_VShader",
				"VShaderDefines":  ["MAX_UV_CHANNEL_IDX 1", "VOUT_WORLD_POS"],
				"VShaderEntryPoint": "VShader",
				"PShader": "GLTF_PBRMetallicRoughness_Transparency_PShader",
				"PShaderEntryPoint": "PShader",
				"PShaderDefines":  ["MAX_UV_CHANNEL_IDX 1", "VOUT_WORLD_POS"],
				"PipelineState": "DoubleSided",
				"VertexStream": "PosNmlTanUvCol"
			},
		
			// TODO: FaceCullingMode::Disabled is better for minimizing peter-panning, but we need backface culling if we
			// want to be able to place lights inside of geometry (eg. emissive spheres). For now, enable backface culling.
			// In future, we need to support tagging assets to not cast shadows at load time
			{
				"Name": "Shadow_2D_SingleSided_Opaque",
				"VShader": "Depth_VShader",
				"VShaderEntryPoint": "VShader",
				"PipelineState": "SingleSided",
				"VertexStream": "PositionUV"
			},
			{
				"Name": "Shadow_2D_SingleSided_AlphaMask",
				"VShader": "Depth_VShader",
				"VShaderEntryPoint": "VShader",
				"VShaderDefines":  ["SABER_INSTANCING", "VOUT_UV0"],
				"PShader": "DepthAlphaMask_PShader",
				"PShaderEntryPoint": "PShader",
				"PShaderDefines":  ["SABER_INSTANCING", "VOUT_UV0"],
				"PipelineState": "SingleSided",
				"VertexStream": "PositionUV"
			},
			{
				"Name": "Shadow_2D_DoubleSided_Opaque",
				"VShader": "Depth_VShader",
				"VShaderEntryPoint": "VShader",
				"PipelineState": "DoubleSided",
				"VertexStream": "PositionUV"
			},
			{
				"Name": "Shadow_2D_DoubleSided_AlphaMask",
				"VShader": "Depth_VShader",
				"VShaderEntryPoint": "VShader",
				"VShaderDefines":  ["SABER_INSTANCING", "VOUT_UV0"],
				"PShader": "DepthAlphaMask_PShader",
				"PShaderEntryPoint": "PShader",
				"PShaderDefines":  ["SABER_INSTANCING", "VOUT_UV0"],
				"PipelineState": "DoubleSided",
				"VertexStream": "PositionUV"
			},
			{
				"Name": "Shadow_Cube_SingleSided_Opaque",
				"VShader": "CubeDepth_VShader",
				"VShaderEntryPoint": "VShader",
				"GShader": "CubeDepth_GShader",
				"GShaderEntryPoint": "GShader",
				"PipelineState": "SingleSided",
				"VertexStream": "PositionUV"
			},
			{
				"Name": "Shadow_Cube_SingleSided_AlphaMask",
				"VShader": "CubeDepth_VShader",
				"VShaderEntryPoint": "VShader",
				"VShaderDefines":  ["SABER_INSTANCING", "VOUT_UV0"],
				"GShader": "CubeDepth_GShader",
				"GShaderEntryPoint": "GShader",
				"GShaderDefines":  ["SABER_INSTANCING", "VOUT_UV0"],
				"PShader": "DepthAlphaMask_PShader",
				"PShaderDefines":  ["SABER_INSTANCING", "VOUT_UV0"],
				"PShaderEntryPoint": "PShader",
				"PipelineState": "SingleSided",
				"VertexStream": "PositionUV"
			},
			{
				"Name": "Shadow_Cube_DoubleSided_Opaque",
				"VShader": "CubeDepth_VShader",
				"VShaderEntryPoint": "VShader",
				"GShader": "CubeDepth_GShader",
				"GShaderEntryPoint": "GShader",
				"PipelineState": "DoubleSided",
				"VertexStream": "PositionUV"
			},
			{
				"Name": "Shadow_Cube_DoubleSided_AlphaMask",
				"VShader": "CubeDepth_VShader",
				"VShaderEntryPoint": "VShader",
				"VShaderDefines":  ["SABER_INSTANCING", "VOUT_UV0"],
				"GShader": "CubeDepth_GShader",
				"GShaderEntryPoint": "GShader",
				"GShaderDefines":  ["SABER_INSTANCING", "VOUT_UV0"],
				"PShader": "DepthAlphaMask_PShader",
				"PShaderEntryPoint": "PShader",
				"PShaderDefines":  ["SABER_INSTANCING", "VOUT_UV0"],
				"PipelineState": "DoubleSided",
				"VertexStream": "PositionUV",
				"Defines": ["SABER_INSTANCING", "VOUT_UV0"]
			}
		]
	},

	"VertexStreams": [
		{
			"Name" : "PosNmlTanUvCol",
			"Slots" : [
				{
					"DataType" : "float3",
					"Name" : "Position",
					"Semantic" : "SV_Position"
				},
				{
					"DataType" : "float3",
					"Name" : "Normal",
					"Semantic" : "NORMAL0"
				},
				{
					"DataType" : "float4",
					"Name" : "Tangent",
					"Semantic" : "TANGENT0"
				},
				{
					"DataType" : "float2",
					"Name" : "UV0",
					"Semantic" : "TEXCOORD0"
				},
				{
					"DataType" : "float2",
					"Name" : "UV1",
					"Semantic" : "TEXCOORD1"
				},
				{
					"DataType" : "float4",
					"Name" : "Color",
					"Semantic" : "COLOR0"
				}
			]
		}
	],

	"PipelineStates": [
		{
			"Name": "SingleSided",
			"RasterizerState" : {
				"FaceCullingMode": "Back"
			},
			"DepthTestMode": "Less"
		},
		{
			"Name": "DoubleSided",
			"RasterizerState" : {
				"FaceCullingMode": "Disabled"
			},
			"DepthTestMode": "Less"
		}
	]
}