{
	"Effect": {
		"Name": "GLTF_PBRMetallicRoughness",
		"Parents": ["Common", "Debug", "RayTracing"],
		"DrawStyles": [
			// Fill GBuffer:
			{
				"Conditions": [
					{ "Rule": "RenderPath", "Mode": "Deferred" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Opaque" },
					{ "Rule": "MaterialSidedness", "Mode": "Single" }
				],
				"Technique": "FillGBuffer_SingleSidedOpaque"
			},
			{
				"Conditions": [
					{ "Rule": "RenderPath", "Mode": "Deferred" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Clip" },
					{ "Rule": "MaterialSidedness", "Mode": "Single" }
				],
				"Technique": "FillGBuffer_SingleSidedAlphaClip"
			},
			{
				"Conditions": [
					{ "Rule": "RenderPath", "Mode": "Deferred" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Opaque" },
					{ "Rule": "MaterialSidedness", "Mode": "Double" }
				],
				"Technique": "FillGBuffer_DoubleSidedOpaque"
			},
			{
				"Conditions": [
					{ "Rule": "RenderPath", "Mode": "Deferred" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Clip" },
					{ "Rule": "MaterialSidedness", "Mode": "Double" }
				],
				"Technique": "FillGBuffer_DoubleSidedAlphaClip"
			},

			// Transparency:
			{
				"Conditions": [
					{ "Rule": "RenderPath", "Mode": "Forward" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Blend" },
					{ "Rule": "MaterialSidedness", "Mode": "Single" }
				],
				"Technique": "AlphaBlend_SingleSided"
			},
			{
				"Conditions": [
					{ "Rule": "RenderPath", "Mode": "Forward" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Blend" },
					{ "Rule": "MaterialSidedness", "Mode": "Double" }
				],
				"Technique": "AlphaBlend_DoubleSided"
			},

			// 2D Shadows:
			{
				"Conditions": [
					{ "Rule": "Shadow", "Mode": "2D" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Opaque" },
					{ "Rule": "MaterialSidedness", "Mode": "Single" }
				],
				"Technique": "Shadow_2D_SingleSided_Opaque"
			},
			{
				"Conditions": [
					{ "Rule": "Shadow", "Mode": "2D" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Clip" },
					{ "Rule": "MaterialSidedness", "Mode": "Single" }
				],
				"Technique": "Shadow_2D_SingleSided_AlphaMask"
			},
			{
				"Conditions": [
					{ "Rule": "Shadow", "Mode": "2D" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Blend" },
					{ "Rule": "MaterialSidedness", "Mode": "Single" }
				],
				"Technique": "Shadow_2D_SingleSided_AlphaMask" // Use the alpha clip variant for alpha-blended shadows
			},
			{
				"Conditions": [
					{ "Rule": "Shadow", "Mode": "2D" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Opaque" },
					{ "Rule": "MaterialSidedness", "Mode": "Double" }
				],
				"Technique": "Shadow_2D_DoubleSided_Opaque"
			},
			{
				"Conditions": [
					{ "Rule": "Shadow", "Mode": "2D" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Clip" },
					{ "Rule": "MaterialSidedness", "Mode": "Double" }
				],
				"Technique": "Shadow_2D_DoubleSided_AlphaMask"
			},
			{
				"Conditions": [
					{ "Rule": "Shadow", "Mode": "2D" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Blend" },
					{ "Rule": "MaterialSidedness", "Mode": "Double" }
				],
				"Technique": "Shadow_2D_DoubleSided_AlphaMask" // Use the alpha clip variant for alpha-blended shadows
			},

			// Cubemap shadows:
			{
				"Conditions": [
					{ "Rule": "Shadow", "Mode": "Cube" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Opaque" },
					{ "Rule": "MaterialSidedness", "Mode": "Single" }
				],
				"Technique": "Shadow_Cube_SingleSided_Opaque"
			},
			{
				"Conditions": [
					{ "Rule": "Shadow", "Mode": "Cube" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Clip" },
					{ "Rule": "MaterialSidedness", "Mode": "Single" }
				],
				"Technique": "Shadow_Cube_SingleSided_AlphaMask"
			},
			{
				"Conditions": [
					{ "Rule": "Shadow", "Mode": "Cube" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Blend" },
					{ "Rule": "MaterialSidedness", "Mode": "Single" }
				],
				"Technique": "Shadow_Cube_SingleSided_AlphaMask" // Use the alpha clip variant for alpha-blended shadows
			},
			{
				"Conditions": [
					{ "Rule": "Shadow", "Mode": "Cube" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Opaque" },
					{ "Rule": "MaterialSidedness", "Mode": "Double" }
				],
				"Technique": "Shadow_Cube_DoubleSided_Opaque"
			},
			{
				"Conditions": [
					{ "Rule": "Shadow", "Mode": "Cube" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Clip" },
					{ "Rule": "MaterialSidedness", "Mode": "Double" }
				],
				"Technique": "Shadow_Cube_DoubleSided_AlphaMask"
			},
			{
				"Conditions": [
					{ "Rule": "Shadow", "Mode": "Cube" },
					{ "Rule": "MaterialAlphaMode", "Mode": "Blend" },
					{ "Rule": "MaterialSidedness", "Mode": "Double" }
				],
				"Technique": "Shadow_Cube_DoubleSided_AlphaMask" // Use the alpha clip variant for alpha-blended shadows
			}
		],

		"Buffers": ["TransformParams", "PBRMetallicRoughnessParams"],

		"Techniques": [
			{
				"Name": "FillGBuffer_SingleSidedOpaque",
				"VShader": "GLTF_PBRMetallicRoughness_VShader",
				"VShaderDefines":  ["MAX_UV_CHANNEL_IDX 1"],
				"VShaderEntryPoint": "VShader",
				"PShader": "GLTF_PBRMetallicRoughness_GBufferFill_PShader",
				"PShaderDefines":  ["MAX_UV_CHANNEL_IDX 1"],
				"PShaderEntryPoint": "PShader",
				"RasterState": "SingleSided",
				"VertexStream": "PosNmlTanUvCol"
			},
			{
				"Name": "FillGBuffer_SingleSidedAlphaClip",
				"Parent" :  "FillGBuffer_SingleSidedOpaque",
				"PShaderDefines":  ["MAX_UV_CHANNEL_IDX 1", "DO_ALPHA_CLIP"]
			},
			{
				"Name": "FillGBuffer_DoubleSidedOpaque",
				"Parent" :  "FillGBuffer_SingleSidedOpaque",
				"RasterState": "DoubleSided"
			},
			{
				"Name": "FillGBuffer_DoubleSidedAlphaClip",
				"Parent" :  "FillGBuffer_SingleSidedAlphaClip",
				"RasterState": "DoubleSided"
			},
			{
				"Name": "AlphaBlend_SingleSided",
				"VShader": "GLTF_PBRMetallicRoughness_VShader",
				"VShaderEntryPoint": "VShader",
				"VShaderDefines":  ["MAX_UV_CHANNEL_IDX 1", "VOUT_WORLD_POS"],
				"PShader": "GLTF_PBRMetallicRoughness_Transparency_PShader",
				"PShaderDefines":  ["MAX_UV_CHANNEL_IDX 1", "VOUT_WORLD_POS"],
				"PShaderEntryPoint": "PShader",
				"RasterState": "SingleSided_AlphaBlend",
				"VertexStream": "PosNmlTanUvCol"				
			},
			{
				"Name": "AlphaBlend_DoubleSided",
				"VShader": "GLTF_PBRMetallicRoughness_VShader",
				"VShaderDefines":  ["MAX_UV_CHANNEL_IDX 1", "VOUT_WORLD_POS"],
				"VShaderEntryPoint": "VShader",
				"PShader": "GLTF_PBRMetallicRoughness_Transparency_PShader",
				"PShaderEntryPoint": "PShader",
				"PShaderDefines":  ["MAX_UV_CHANNEL_IDX 1", "VOUT_WORLD_POS"],
				"RasterState": "DoubleSided_AlphaBlend",
				"VertexStream": "PosNmlTanUvCol"
			},
		
			// TODO: FaceCullingMode::Disabled is better for minimizing peter-panning, but we need backface culling if we
			// want to be able to place lights inside of geometry (eg. emissive spheres). For now, enable backface culling.
			// In future, we need to support tagging assets to not cast shadows at load time
			{
				"Name": "Shadow_2D_SingleSided_Opaque",
				"VShader": "Depth_VShader",
				"VShaderEntryPoint": "VShader",
				"RasterState": "SingleSided",
				"VertexStream": "PositionUV"
			},
			{
				"Name": "Shadow_2D_SingleSided_AlphaMask",
				"VShader": "Depth_VShader",
				"VShaderEntryPoint": "VShader",
				"VShaderDefines":  ["SABER_INSTANCING", "VOUT_UV0"],
				"PShader": "DepthAlphaMask_PShader",
				"PShaderEntryPoint": "PShader",
				"PShaderDefines":  ["SABER_INSTANCING", "VOUT_UV0"],
				"RasterState": "SingleSided",
				"VertexStream": "PositionUV"
			},
			{
				"Name": "Shadow_2D_DoubleSided_Opaque",
				"VShader": "Depth_VShader",
				"VShaderEntryPoint": "VShader",
				"RasterState": "DoubleSided",
				"VertexStream": "PositionUV"
			},
			{
				"Name": "Shadow_2D_DoubleSided_AlphaMask",
				"VShader": "Depth_VShader",
				"VShaderEntryPoint": "VShader",
				"VShaderDefines":  ["SABER_INSTANCING", "VOUT_UV0"],
				"PShader": "DepthAlphaMask_PShader",
				"PShaderEntryPoint": "PShader",
				"PShaderDefines":  ["SABER_INSTANCING", "VOUT_UV0"],
				"RasterState": "DoubleSided",
				"VertexStream": "PositionUV"
			},
			{
				"Name": "Shadow_Cube_SingleSided_Opaque",
				"VShader": "CubeDepth_VShader",
				"VShaderEntryPoint": "VShader",
				"GShader": "CubeDepth_GShader",
				"GShaderEntryPoint": "GShader",
				"RasterState": "SingleSided",
				"VertexStream": "PositionUV"
			},
			{
				"Name": "Shadow_Cube_SingleSided_AlphaMask",
				"VShader": "CubeDepth_VShader",
				"VShaderEntryPoint": "VShader",
				"VShaderDefines":  ["SABER_INSTANCING", "VOUT_UV0"],
				"GShader": "CubeDepth_GShader",
				"GShaderEntryPoint": "GShader",
				"GShaderDefines":  ["SABER_INSTANCING", "VOUT_UV0"],
				"PShader": "DepthAlphaMask_PShader",
				"PShaderDefines":  ["SABER_INSTANCING", "VOUT_UV0"],
				"PShaderEntryPoint": "PShader",
				"RasterState": "SingleSided",
				"VertexStream": "PositionUV"
			},
			{
				"Name": "Shadow_Cube_DoubleSided_Opaque",
				"VShader": "CubeDepth_VShader",
				"VShaderEntryPoint": "VShader",
				"GShader": "CubeDepth_GShader",
				"GShaderEntryPoint": "GShader",
				"RasterState": "DoubleSided",
				"VertexStream": "PositionUV"
			},
			{
				"Name": "Shadow_Cube_DoubleSided_AlphaMask",
				"VShader": "CubeDepth_VShader",
				"VShaderEntryPoint": "VShader",
				"VShaderDefines":  ["SABER_INSTANCING", "VOUT_UV0"],
				"GShader": "CubeDepth_GShader",
				"GShaderEntryPoint": "GShader",
				"GShaderDefines":  ["SABER_INSTANCING", "VOUT_UV0"],
				"PShader": "DepthAlphaMask_PShader",
				"PShaderEntryPoint": "PShader",
				"PShaderDefines":  ["SABER_INSTANCING", "VOUT_UV0"],
				"RasterState": "DoubleSided",
				"VertexStream": "PositionUV",
				"Defines": ["SABER_INSTANCING", "VOUT_UV0"]
			}
		]
	},

	"VertexStreams": [
		{
			"Name" : "PosNmlTanUvCol",
			"Slots" : [
				{
					"DataType" : "float3",
					"Name" : "Position",
					"Semantic" : "SV_Position"
				},
				{
					"DataType" : "float3",
					"Name" : "Normal",
					"Semantic" : "NORMAL0"
				},
				{
					"DataType" : "float4",
					"Name" : "Tangent",
					"Semantic" : "TANGENT0"
				},
				{
					"DataType" : "float2",
					"Name" : "UV0",
					"Semantic" : "TEXCOORD0"
				},
				{
					"DataType" : "float2",
					"Name" : "UV1",
					"Semantic" : "TEXCOORD1"
				},
				{
					"DataType" : "float4",
					"Name" : "Color",
					"Semantic" : "COLOR0"
				}
			]
		}
	],

	"RasterizationStates": [
		{
			"Name": "SingleSided",
			"RasterizerState" : {
				"FaceCullingMode": "Back"
			},
			"DepthStencilState" : {
				"DepthComparison": "Less"
			}
		},
		{
			"Name": "SingleSided_AlphaBlend",
			"RasterizerState" : {
				"FaceCullingMode": "Back"
			},
			"DepthStencilState" : {
				"DepthComparison": "Less",
				"DepthWriteMask": "Zero"
			},
			"BlendState" : {
					"RenderTargets": [
						{
							"BlendEnable" : true,
							"SrcBlend" : "SrcAlpha",
							"DstBlend" : "InvSrcAlpha",
							"BlendOp": "Add"
						}
					]
				}
		},
		{
			"Name": "DoubleSided",
			"RasterizerState" : {
				"FaceCullingMode": "Disabled"
			},
			"DepthStencilState" : {
				"DepthComparison": "Less"
			}
		},
		{
			"Name": "DoubleSided_AlphaBlend",
			"RasterizerState" : {
				"FaceCullingMode": "Disabled"
			},
			"DepthStencilState" : {
				"DepthComparison": "Less",
				"DepthWriteMask": "Zero"
			},
			"BlendState" : {
					"RenderTargets": [
						{
							"BlendEnable" : true,
							"SrcBlend" : "SrcAlpha",
							"DstBlend" : "InvSrcAlpha",
							"BlendOp": "Add"
						}
					]
				}
		}
	]
}